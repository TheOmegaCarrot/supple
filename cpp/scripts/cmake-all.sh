#!/bin/bash

# Compile and test with GCC and Clang
# in both debug and release configuration
# building against C++17, C++20, and C++23
#
# Library consumers should disregard this file,
# unless you want to compile and run 12 versions
# of this library's tests

cd ..

cmake -S cpp -B all/gcc-debug -DCMAKE_BUILD_TYPE=Debug -DFULL_TESTS=YES -DAUTOMATED_BUILD=YES -G Ninja 
cmake -S cpp -B all/gcc-release -DCMAKE_BUILD_TYPE=Release -DFULL_TESTS=Yes -DAUTOMATED_BUILD=YES -G Ninja 
env CXX=/usr/bin/clang++ cmake -S cpp -B all/clang-debug -DCMAKE_BUILD_TYPE=Debug -DFULL_TESTS=Yes -DAUTOMATED_BUILD=YES -G Ninja 
env CXX=/usr/bin/clang++ cmake -S cpp -B all/clang-release -DCMAKE_BUILD_TYPE=Release -DFULL_TESTS=Yes -DAUTOMATED_BUILD=YES -G Ninja 


cat << EOF

##############################################################################
#                               GCC DEBUG                                    #
##############################################################################

EOF

cmake --build all/gcc-debug --parallel $(nproc)

cat << EOF

##############################################################################
#                                C++ 17                                      #
##############################################################################

EOF

./all/gcc-debug/test_core_17

cat << EOF

##############################################################################
#                                C++ 20                                      #
##############################################################################

EOF

./all/gcc-debug/test_core_20

cat << EOF

##############################################################################
#                                C++ 23                                      #
##############################################################################

EOF

./all/gcc-debug/test_core_23



cat << EOF

##############################################################################
#                              GCC RELEASE                                   #
##############################################################################

EOF


cmake --build all/gcc-release --parallel $(nproc)

cat << EOF

##############################################################################
#                                C++ 17                                      #
##############################################################################

EOF

./all/gcc-debug/test_core_17

cat << EOF

##############################################################################
#                                C++ 20                                      #
##############################################################################

EOF

./all/gcc-debug/test_core_20

cat << EOF

##############################################################################
#                                C++ 23                                      #
##############################################################################

EOF

./all/gcc-debug/test_core_23



cat << EOF

##############################################################################
#                              CLANG DEBUG                                   #
##############################################################################

EOF


cmake --build all/clang-debug --parallel $(nproc)
cat << EOF

##############################################################################
#                                C++ 17                                      #
##############################################################################

EOF

./all/gcc-debug/test_core_17

cat << EOF

##############################################################################
#                                C++ 20                                      #
##############################################################################

EOF

./all/gcc-debug/test_core_20

cat << EOF

##############################################################################
#                                C++ 23                                      #
##############################################################################

EOF

./all/gcc-debug/test_core_23


cat << EOF

##############################################################################
#                             CLANG RELEASE                                  #
##############################################################################

EOF


cmake --build all/clang-release --parallel $(nproc)

cat << EOF

##############################################################################
#                                C++ 17                                      #
##############################################################################

EOF

./all/gcc-debug/test_core_17

cat << EOF

##############################################################################
#                                C++ 20                                      #
##############################################################################

EOF

./all/gcc-debug/test_core_20

cat << EOF

##############################################################################
#                                C++ 23                                      #
##############################################################################

EOF

./all/gcc-debug/test_core_23
